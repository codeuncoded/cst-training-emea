<!DOCTYPE html>
<html lang="en">

<head>
    <!-- Latest compiled and minified CSS -->
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css"
        integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">
    <script src="nexmoClient.js"></script>
</head>

<body>
    <div class="content-fluid">
        <h1>Call Phone from App</h1>
        <div class="row" style="margin: 10px;">
            <form id="call-phone-form" class="col-xs-12">
                <div class="input-group">
                    <input id="phone-number-input" type="text" name="phonenumber" value="" class="form-control"
                        placeholder="Recipient's phone number">
                </div>
                <button class="btn btn-primary" value="Call" name="call"> Call </button>
                <button class="btn btn-default" value="Hang Up" name="hangup">Hang Up</button>
            </form>
        </div>
    </div>
    </div>

</body>


<script>
    // const USER_JWT = "PASTE YOUR JWT HERE";
    const USER_JWT = "eyJhbGciOiJSUzI1NiIsInR5cCI6IkpXVCJ9.eyJpYXQiOjE1ODAxMzQ5NTIsImp0aSI6Ijc1MDRlYTQwLTQxMTAtMTFlYS1iY2Q5LWZmNzc1YjYzYWZlZCIsImV4cCI6MTU4MDE1NjU1MCwiYWNsIjp7InBhdGhzIjp7Ii8qL3VzZXJzLyoqIjp7fSwiLyovY29udmVyc2F0aW9ucy8qKiI6e30sIi8qL3Nlc3Npb25zLyoqIjp7fSwiLyovZGV2aWNlcy8qKiI6e30sIi8qL2ltYWdlLyoqIjp7fSwiLyovbWVkaWEvKioiOnt9LCIvKi9hcHBsaWNhdGlvbnMvKioiOnt9LCIvKi9wdXNoLyoqIjp7fSwiLyova25vY2tpbmcvKioiOnt9fX0sImFwcGxpY2F0aW9uX2lkIjoiMmFiZjllNDUtYWQ4ZS00MGFiLTkyNmMtYTg3ZDc3NDQxMWY3Iiwic3ViIjoiZXBvcnRvbGFuIn0.Z5ptUQsMA-xp2M-gC0lLgLSYnZlozWnTu4D6lIPTJIBEjgq50MC6YbjDHa4ZfpzeiYS2TjNk-icLaa9t2yR2VcOFfdqwxatk1hA0Wi9viCeubXVbDN8RelJu1QaVJYeMRUhtifLVoD2Tl_f3ESl_IxXaWD9dm8445fojJiLGh4ExShEvY8Xcq0LyrCCo44wqYDtVFQxzwOX0naLWFobuOnW7wIGIzZdeQREvlAdWGk7PcTvJLiSDIVVW5QywVXRvuQToHnNQdwp8YPy-TmoW2zNeTx9yvZ1dxMvPy4ypRjCuzfIpuKEUjALGpoCJkohNbwLL-bSOJlh_IvCSstmhNw";
    const callPhoneForm = document.getElementById("call-phone-form");
    const callButton = callPhoneForm.children.call;
    const hangUpButton = callPhoneForm.children.hangup;
    let currentCall = null;
    var NXClient = new NexmoClient({ debug: true })
        .login(USER_JWT)
        .then(app => {
            callButton.addEventListener("click", event => {
                event.preventDefault();
                let number = document.getElementById('phone-number-input').value;
                if (!number){
                    return;
                }
                app.callServer(number).then((call) => {
                    console.log('Call Server:', call);
                    currentCall = call;
                }).catch((err) => {
                    console.log('Err:', err);
                });
            });
            hangUpButton.addEventListener("click", event => {
                event.preventDefault();
                console.log('Hangup Current Call')
                if (!currentCall) {
                    return;
                }
                currentCall.hangUp({ reason_code: 1, reason_text: 'webapp hangup - cst' });
            });
        })
        .catch(console.error);
</script>

</body>

</html>